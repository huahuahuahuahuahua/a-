(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-bookshelf-bookshelf"],{"17f2":function(e,t,n){"use strict";n.r(t);var i=n("4301"),a=n("a7e5");for(var o in a)"default"!==o&&function(e){n.d(t,e,(function(){return a[e]}))}(o);n("d4ba");var s,r=n("f0c5"),c=Object(r["a"])(a["default"],i["b"],i["c"],!1,null,"202f9e18",null,!1,i["a"],s);t["default"]=c.exports},"23a8":function(e,t,n){"use strict";n.r(t);var i=n("ba6d"),a=n.n(i);for(var o in i)"default"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);t["default"]=a.a},"29cc":function(e,t,n){"use strict";var i;n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return i}));var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ezpage",{attrs:{title:e.shelfInfo.name}},[n("v-uni-view",{staticStyle:{height:"100%"},attrs:{slot:"contentSection"},slot:"contentSection"},[n("v-uni-canvas",{staticStyle:{position:"absolute",left:"-350px",width:"350px",height:"750px"},attrs:{id:"myPoster","canvas-id":"myPoster",type:"2d"}}),e.showShareMenu?n("ezshare",{on:{selected:function(t){arguments[0]=t=e.$handleEvent(t),e.onShareSelected.apply(void 0,arguments)},dismiss:function(t){arguments[0]=t=e.$handleEvent(t),e.onShareDismiss.apply(void 0,arguments)}}}):e._e(),n("v-uni-view",{staticStyle:{"justify-content":"start",display:"flex","flex-wrap":"wrap","padding-bottom":"70px"}},e._l(e.books,(function(t){return n("v-uni-view",{staticStyle:{width:"33.3%",padding:"10px","margin-bottom":"10px"}},[n("bookcell",{attrs:{data:t}}),e.isEditing?n("v-uni-view",{staticStyle:{"font-size":"10px","text-align":"center","margin-top":"10px"},attrs:{"data-id":t._id},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.btnDeleteBook.apply(void 0,arguments)}}},[n("v-uni-text",{staticStyle:{padding:"5px 10px",background:"#f3433e",color:"#fff","border-radius":"5px"}},[e._v("编辑")])],1):e._e()],1)})),1)],1),e.shelfInfo.isowner?n("v-uni-view",{staticStyle:{padding:"10px"},attrs:{slot:"tabSection"},slot:"tabSection"},[e.isEditing?n("v-uni-view",{staticStyle:{"background-color":"#000",width:"100%",height:"50px","border-radius":"25px",display:"flex","line-height":"50px",color:"#fff","justify-content":"space-between"}},[n("v-uni-view"),n("v-uni-view",{staticStyle:{flex:"1","text-align":"center"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.btnExitEditing.apply(void 0,arguments)}}},[e._v("退出编辑模式")]),n("v-uni-view")],1):n("v-uni-view",{staticStyle:{"background-color":"#2979ff",width:"100%",height:"50px","border-radius":"25px",display:"flex","line-height":"50px",color:"#fff","justify-content":"space-between"}},[n("v-uni-view",{staticClass:"iconfont icon-share",staticStyle:{width:"50px",height:"50px","text-align":"center"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.showShareMenu=!0}}}),n("v-uni-view",{staticStyle:{flex:"1","text-align":"center"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.btnScan.apply(void 0,arguments)}}},[e._v("添加图书")]),n("v-uni-view",{staticClass:"iconfont icon-apps",staticStyle:{width:"50px",height:"50px","text-align":"center"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.btnEnterEditing.apply(void 0,arguments)}}})],1)],1):e._e()],1)},o=[]},3015:function(e,t,n){"use strict";var i;n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return i}));var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-navigator",{attrs:{url:"../bookdetail/bookdetail?isbn="+e.data.isbn}},[n("v-uni-image",{staticStyle:{width:"100%",height:"150px"},attrs:{src:e.data.cover_url,mode:"aspectFit"}}),n("v-uni-view",{staticStyle:{"font-size":"16px","text-align":"center",width:"100%","text-overflow":"ellipsis","white-space":"nowrap",overflow:"hidden"}},[e._v(e._s(e.data.title))])],1)},o=[]},4301:function(e,t,n){"use strict";var i;n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return i}));var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",{staticClass:"ezshare"},[n("v-uni-view",[n("v-uni-view",{staticClass:"divider",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.clicked_selected(0)}}},[n("v-uni-button",{staticClass:"clear_button",attrs:{"open-type":"share"}},[e._v("选择好友发送邀请")])],1),n("v-uni-view",{staticClass:"divider",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.clicked_selected(1)}}},[e._v("生成朋友圈分享海报")]),n("v-uni-view",{style:{height:e.safeArea.top+30+"px"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.clicked_cancel.apply(void 0,arguments)}}},[e._v("取消")])],1)],1)},o=[]},"59e6":function(e,t,n){"use strict";n.r(t);var i=n("5c3d"),a=n.n(i);for(var o in i)"default"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);t["default"]=a.a},"5c3d":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i={props:{data:{type:Object}},mounted:function(){}};t.default=i},6838:function(e,t,n){var i=n("e461");"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var a=n("4f06").default;a("fb1261e2",i,!0,{sourceMap:!1,shadowMode:!1})},"73f6":function(e,t,n){var i=n("24fb");t=i(!1),t.push([e.i,"uni-page-body[data-v-488139b2]{background-color:#fff}.popup-box[data-v-488139b2]{text-align:center;background-color:#fff;padding:%?30?%;border-radius:%?10?%;font-size:%?28?%}body.?%PAGE?%[data-v-488139b2]{background-color:#fff}",""]),e.exports=t},"7f7b":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=uni.getSystemInfoSync(),a={data:function(){return{safeArea:null}},props:{},methods:{clicked_selected:function(e){this.$emit("selected",e),this.$emit("dismiss")},clicked_cancel:function(){this.$emit("dismiss")}},mounted:function(){this.safeArea=i.safeArea}};t.default=a},"88c0":function(e,t,n){"use strict";var i=n("92e9"),a=n.n(i);a.a},"92e9":function(e,t,n){var i=n("73f6");"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var a=n("4f06").default;a("4aecf210",i,!0,{sourceMap:!1,shadowMode:!1})},"963f":function(e,t,n){"use strict";n.r(t);var i=n("29cc"),a=n("23a8");for(var o in a)"default"!==o&&function(e){n.d(t,e,(function(){return a[e]}))}(o);n("88c0");var s,r=n("f0c5"),c=Object(r["a"])(a["default"],i["b"],i["c"],!1,null,"488139b2",null,!1,i["a"],s);t["default"]=c.exports},a7e5:function(e,t,n){"use strict";n.r(t);var i=n("7f7b"),a=n.n(i);for(var o in i)"default"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);t["default"]=a.a},ba6d:function(e,t,n){"use strict";var i=n("4ea4");n("99af"),n("ac1f"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n("96cf");var a=i(n("1da1")),o=i(n("ea02")),s=i(n("3d24")),r=i(n("17f2")),c=i(n("e212")),l={components:{ezpage:s.default,bookcell:c.default,ezshare:r.default},data:function(){return{title:"",isEditing:!1,shelfInfo:null,shelfid:null,canloadmore:!0,showShareMenu:!1,books:[]}},onLoad:function(e){this.shelfid=e.id,this.shelfid||uni.navigateBack(),this.getShelfInfo(),this.requestBookList()},onReachBottom:function(){this.requestBookList(this.books[this.books.length-1]._id)},onShareAppMessage:function(){return{title:this.title,path:"/pages/me/index?scene=sid="+this.shelfInfo._id}},methods:{drawPoster:function(){var e=this;uni.showLoading({title:"生成中",mask:!0});var t=wx.createSelectorQuery();t.select("#myPoster").fields({node:!0,size:!0}).exec(function(){var t=(0,a.default)(regeneratorRuntime.mark((function t(n){var i,a,s,r,c,l,u,f;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=n[0].node,a=i.getContext("2d"),s=uni.getSystemInfoSync().pixelRatio,i.width=n[0].width*s,i.height=n[0].height*s,a.scale(s,s),a.fillStyle="#ffffff",a.fillRect(0,0,350,750),a.fillStyle="black",a.fontSize=16,a.fillText(e.shelfInfo.name,70,25),a.fontSize=12,a.fillText("馆主："+e.shelfInfo.ownerinfo.nickName,70,44),a.fontSize=12,a.fillText("地址："+e.shelfInfo.address,70,60),r=i.createImage(),r.onload=function(e){a.drawImage(r,10,15,50,50)},r.src=e.shelfInfo.ownerinfo.avatarUrl,c=Math.min(e.books.length,9),l=0,u=function t(){var n=e.books[l];uni.getImageInfo({src:n.cover_url,success:function(e){var n=i.createImage();n.onload=function(){var e=115*Math.floor(l%3)+10,o=165*Math.floor(l/3)+80;a.drawImage(n,e,o,100,150),l<c-1?(l++,t()):(console.log("全部封面加载结束"),uni.hideLoading(),uni.canvasToTempFilePath({canvas:i,success:function(e){uni.previewImage({current:e.tempFilePath,urls:[e.tempFilePath]})},fail:function(e){console.log(e)}}))},n.src=e.path}})},t.next=23,o.default.call({name:"getwxacode",data:{scene:"sid="+e.shelfInfo._id}});case 23:f=t.sent,wx.getFileSystemManager().writeFileSync("".concat(wx.env.USER_DATA_PATH,"/mpcode.jpg"),uni.arrayBufferToBase64(f.result.data),"base64"),uni.getImageInfo({src:"".concat(wx.env.USER_DATA_PATH,"/mpcode.jpg"),success:function(e){var t=i.createImage();t.onload=function(e){a.drawImage(t,180,580,160,160),u()},t.src=e.path}});case 26:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},onShareSelected:function(e){1==e&&this.drawPoster()},onShareDismiss:function(){this.showShareMenu=!1},getShelfInfo:function(){var e=this;o.default.call({name:"bookshelfs",data:{action:"get",_id:this.shelfid},success:function(t){console.log(t.result),e.shelfInfo=t.result},fail:function(e){console.log("shelfInfo-err:"+e)}})},requestBookList:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;t&&!this.canloadmore||o.default.call({name:"books",data:{action:"listbyshelf",shelfid:this.shelfid,start:t},success:function(n){e.canloadmore=n.result.length>=9,e.books=t?e.books.concat(n.result):n.result}})},btnDeleteBook:function(e){var t=this;console.log(e.currentTarget.dataset.id),uni.showActionSheet({itemList:["置顶","删除"],success:function(n){0==n.tapIndex?o.default.call({name:"books",data:{action:"movetop",bookid:e.currentTarget.dataset.id},success:function(e){t.requestBookList()}}):1==n.tapIndex&&o.default.call({name:"books",data:{action:"delete",shelfid:t.shelfid,bookid:e.currentTarget.dataset.id},success:function(e){t.requestBookList()}})}})},btnExitEditing:function(){this.isEditing=!1},btnEnterEditing:function(){this.isEditing=!0},btnScan:function(){var e=this;console.log("btnScan"),uni.scanCode({success:function(){var t=(0,a.default)(regeneratorRuntime.mark((function t(n){var i,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log(n),t.next=3,o.default.call({name:"ISBNQuery",data:{isbn:n.result}});case 3:return i=t.sent,t.next=6,o.default.call({name:"books",data:{action:"add",shelfid:e.shelfid,isbnid:i.result._id}});case 6:a=t.sent,console.log(a),e.requestBookList();case 9:case"end":return t.stop()}}),t)})));function n(e){return t.apply(this,arguments)}return n}(),fail:function(e){console.log("scanCode-err",e)}})}}};t.default=l},d4ba:function(e,t,n){"use strict";var i=n("6838"),a=n.n(i);a.a},e212:function(e,t,n){"use strict";n.r(t);var i=n("3015"),a=n("59e6");for(var o in a)"default"!==o&&function(e){n.d(t,e,(function(){return a[e]}))}(o);var s,r=n("f0c5"),c=Object(r["a"])(a["default"],i["b"],i["c"],!1,null,"740edbac",null,!1,i["a"],s);t["default"]=c.exports},e461:function(e,t,n){var i=n("24fb");t=i(!1),t.push([e.i,".clear_button[data-v-202f9e18]:after{border:none}.clear_button[data-v-202f9e18]{border:none;background:none;padding:0!important;margin:0!important;border-radius:0;line-height:inherit}.ezshare[data-v-202f9e18]{width:100%;height:100%;background:rgba(0,0,0,.3);position:absolute;z-index:999999}.ezshare>uni-view[data-v-202f9e18]{width:100%;bottom:0;background:#fff;position:fixed}.ezshare>uni-view>uni-view[data-v-202f9e18]{text-align:center;font-size:16px;height:50px;line-height:50px;color:#000}.ezshare>uni-view>uni-view.divider[data-v-202f9e18]{border-bottom:1px solid #f2f2f2}.ezshare>uni-view>uni-view[data-v-202f9e18]:nth-child(3){color:red}",""]),e.exports=t}}]);